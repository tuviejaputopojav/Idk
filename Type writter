local Main = {}

function Main:TypeWrite(txt, col, outlinecol, voiceid, rotspeed, rotmult, SpecialCharDly, rotspeed2, rotspeed3, agression, agression2)
    task.spawn(function()
        local Players = game:GetService("Players")
        local RunService = game:GetService("RunService")
        local Debris = game:GetService("Debris")
        local player = Players.LocalPlayer
        local character = player.Character or player.CharacterAdded:Wait()
        local head = character:WaitForChild("Head")

        -- Eliminar instancias anteriores
        pcall(function()
            head:FindFirstChild("Text") and head.Text:Destroy()
            workspace:FindFirstChild("Text") and workspace.Text:Destroy()
        end)

        -- Billboard GUI
        local billboard = Instance.new("BillboardGui")
        billboard.Name = "Text"
        billboard.Adornee = head
        billboard.Size = UDim2.new(0, 300, 0, 50) -- Tamaño fijo en píxeles
        billboard.SizeOffset = Vector2.new(0, 0)
        billboard.StudsOffset = Vector3.new(0, 5, 0)
        billboard.AlwaysOnTop = true
        billboard.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
        billboard.ResetOnSpawn = false
        billboard.Parent = head

        -- Frame y texto
        local frame = Instance.new("Frame")
        frame.BackgroundTransparency = 1
        frame.Size = UDim2.new(1, 0, 1, 0)
        frame.ZIndex = 15
        frame.Parent = billboard

        local label = Instance.new("TextLabel")
        label.Size = UDim2.new(3, 0, 1, 0)
        label.Position = UDim2.new(-1.1, 0, -0.8, 0)
        label.BackgroundTransparency = 1
        label.Text = ""
        label.Font = Enum.Font.Arcade
        label.TextSize = 40
        label.TextColor3 = col
        label.TextStrokeColor3 = outlinecol
        label.TextStrokeTransparency = 0
        label.TextWrapped = true
        label.TextYAlignment = Enum.TextYAlignment.Top
        label.Parent = frame

        -- Sonido base
        local baseSound = Instance.new("Sound")
        baseSound.SoundId = voiceid
        baseSound.Looped = false
        baseSound.Volume = 5
        baseSound.Name = "Text"
        baseSound.Parent = workspace

        -- Movimiento visual
        spawn(function()
            for i = 1, 1355 do
                if label and billboard then
                    label.Rotation = math.cos(i / rotspeed) * rotmult
                    billboard.StudsOffset = Vector3.new(
                        math.cos(i / rotspeed2) * agression,
                        2 + math.sin(i / rotspeed3) * agression2,
                        0
                    )
                    task.wait(0.01)
                end
            end
        end)

        -- Máquina de escribir
        local currentText = ""
        for i = 1, #txt do
            currentText = string.sub(txt, 1, i)
            label.Text = currentText

            -- Sonido por letra
            local s = baseSound:Clone()
            s.Parent = head
            s:Play()
            Debris:AddItem(s, 1)

            local c = string.sub(txt, i, i)
            if c == "." then
                wait(0.6)
            elseif c == "," or c == ";" or c == "!" then
                wait(SpecialCharDly)
            end

            wait(0.03)
        end

        task.wait(2)
        billboard:Destroy()
    end)
end

return Main
